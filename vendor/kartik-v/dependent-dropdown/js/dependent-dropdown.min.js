/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version 1.0.0
 *
 * A multi level dependent dropdown JQuery plugin. The plugin
 * allows nested and combined dependencies.
 * 
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */(function(e){var t=function(t,n){return typeof t==="undefined"||t===null||t===undefined||t==[]||t===""||n&&e.trim(t)===""};var n=function(t,n,r,i){var s=n==i&&i!==null?{value:n,text:r,selected:"selected"}:{value:n,text:r};e("<option/>",s).appendTo(t)};var r=function(t,r,i){var s=e("<select>");if(r!==false){n(s,"",r,i)}e.each(t,function(t,r){if(r.id){n(s,r.id,r.name,i)}else{var o=e("<optgroup>",{label:t});e.each(r,function(e,t){n(o,t.id,t.name,i)});o.appendTo(s)}});return s.html()};var s=function(i,s,o,u,a,f,l,c,h,p,d){var v=i,m=s,g=o,y=u,b=a,w=0,E=h,S=p,x=d;var T={url:m,type:"post",data:{depdrop_parents:y},dataType:"json",success:function(i){var s=S===false?t(i.selected)?null:i.selected:S;if(i==null||i.length===0){n(v,"",E,"")}else{v.html(r(i.output,b,s));if(v.find("optgroup").length>0){v.find('option[value=""]').attr("disabled","disabled")}if(i.output.length!==0){v.val(s);v.removeAttr("disabled")}}w=v.find("option").length;if(v.find('option[value=""]').length>0){w--}v.trigger("depdrop.change",[g,e("#"+g).val(),w,S])}};T["beforeSend"]=function(){v.trigger("depdrop.beforeChange",[g,e("#"+g).val(),S]);v.attr("disabled","disabled");v.html("");if(f){v.addClass(l);v.html('<option id="">'+c+"</option>")}};T["error"]=function(){v.trigger("depdrop.error",[g,e("#"+g).val(),S])};T["complete"]=function(){v.trigger("depdrop.afterChange",[g,e("#"+g).val(),S]);x();if(f){v.removeClass(l)}};return T};var o=function(t,n,r){var u=e("#"+n[t]),a={},f,l=e("#"+n[t+1]),c=n.length;for(i=0;i<=t;i++){f=e("#"+n[i]);a[i]=f.val()}var h=r[t+1];if(t<c-1){e.ajax(s(l,l.data("url"),l.attr("id"),a,l.data("placeholder"),l.data("loading"),l.data("loadingClass"),l.data("loadingText"),l.data("emptyMsg"),h,function(){o(t+1,n,r)}))}};var u=function(t,n){this.$element=e(t);this.url=n.url;this.depends=n.depends;this.loading=n.loading;this.loadingClass=n.loadingClass;this.loadingText=n.loadingText;this.placeholder=n.placeholder;this.emptyMsg=n.emptyMsg;this.initialize=n.initialize;this.initData();this.init()};u.prototype={constructor:u,initData:function(){var e=this;e.$element.data("url",e.url);e.$element.data("depends",e.depends);e.$element.data("placeholder",e.placeholder);e.$element.data("loading",e.loading);e.$element.data("loadingClass",e.loadingClass);e.$element.data("loadingText",e.loadingText);e.$element.data("emptyMsg",e.emptyMsg);e.$element.data("initialize",e.initialize)},init:function(){var t=this,n=t.depends,r,i,s=null,u=n.length,a=t.$element.val(),f={},l=t.$element.find("option").length;if(l==0||t.$element.find('option[value=""]').length==l){t.$element.attr("disabled","disabled")}for(var c=0;c<u;c++){r=e("#"+n[c]);r.on("change",function(){t.setDependency(r,n,u,false)})}if(t.initialize===true){for(var h=0;h<u;h++){if(h>0){f[h]=e("#"+n[h]).val()}}n[u]=t.$element.attr("id");f[u]=t.$element.val();var p=n.join(),d="";e(document).ready(function(){o(0,n,f)})}t.$element.trigger("depdrop.init")},setDependency:function(t,n,r,i){var o=this,u={},a=i,f=function(){o.$element.trigger("change")};for(var l=0;l<r;l++){var c=e("#"+n[l]);u[l]=c.val()}e.ajax(s(o.$element,o.url,t.attr("id"),u,o.placeholder,o.loading,o.loadingClass,o.loadingText,o.emptyMsg,a,f))}};e.fn.depdrop=function(t){var n=Array.apply(null,arguments);n.shift();return this.each(function(){var r=e(this),i=r.data("depdrop"),s=typeof t==="object"&&t;if(!i){r.data("depdrop",i=new u(this,e.extend({},e.fn.depdrop.defaults,s,e(this).data())))}if(typeof t==="string"){i[t].apply(i,n)}})};e.fn.depdrop.defaults={url:"",loading:true,loadingClass:"kv-loading",loadingText:"Loading ...",placeholder:"Select ...",emptyMsg:"No data found",initialize:false};e(function(){e("select.depdrop").depdrop()})})(jQuery)